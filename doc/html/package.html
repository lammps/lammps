

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>package command &mdash; LAMMPS documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/tabs.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/lammps.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/lammps.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->

  
  <script src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="pair_coeff command" href="pair_coeff.html" />
    <link rel="prev" title="next command" href="next.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="Manual.html">
          

          
            
            <img src="_static/lammps-logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="lammps_version">Version: <b>24 Dec 2020</b></div>
              <div class="lammps_release">git info: patch 24Dec2020-115-g2b8a0d310</div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Install.html">2. Install LAMMPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Build.html">3. Build LAMMPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Run_head.html">4. Run LAMMPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Commands.html">5. Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="Packages.html">6. Optional packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="Speed.html">7. Accelerate performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="Howto.html">8. Howto discussions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Examples.html">9. Example scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tools.html">10. Auxiliary tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="Errors.html">11. Errors</a></li>
</ul>
<p class="caption"><span class="caption-text">Programmer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Library.html">1. LAMMPS Library Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="Python_head.html">2. Use Python with LAMMPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Modify.html">3. Modifying &amp; extending LAMMPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Developer.html">4. Information for Developers</a></li>
</ul>
<p class="caption"><span class="caption-text">Index</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="commands_list.html">Commands</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="angle_coeff.html">angle_coeff command</a></li>
<li class="toctree-l2"><a class="reference internal" href="angle_style.html">angle_style command</a></li>
<li class="toctree-l2"><a class="reference internal" href="atom_modify.html">atom_modify command</a></li>
<li class="toctree-l2"><a class="reference internal" href="atom_style.html">atom_style command</a></li>
<li class="toctree-l2"><a class="reference internal" href="balance.html">balance command</a></li>
<li class="toctree-l2"><a class="reference internal" href="bond_coeff.html">bond_coeff command</a></li>
<li class="toctree-l2"><a class="reference internal" href="bond_style.html">bond_style command</a></li>
<li class="toctree-l2"><a class="reference internal" href="bond_write.html">bond_write command</a></li>
<li class="toctree-l2"><a class="reference internal" href="boundary.html">boundary command</a></li>
<li class="toctree-l2"><a class="reference internal" href="box.html">box command</a></li>
<li class="toctree-l2"><a class="reference internal" href="change_box.html">change_box command</a></li>
<li class="toctree-l2"><a class="reference internal" href="clear.html">clear command</a></li>
<li class="toctree-l2"><a class="reference internal" href="comm_modify.html">comm_modify command</a></li>
<li class="toctree-l2"><a class="reference internal" href="comm_style.html">comm_style command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute.html">compute command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_modify.html">compute_modify command</a></li>
<li class="toctree-l2"><a class="reference internal" href="create_atoms.html">create_atoms command</a></li>
<li class="toctree-l2"><a class="reference internal" href="create_bonds.html">create_bonds command</a></li>
<li class="toctree-l2"><a class="reference internal" href="create_box.html">create_box command</a></li>
<li class="toctree-l2"><a class="reference internal" href="delete_atoms.html">delete_atoms command</a></li>
<li class="toctree-l2"><a class="reference internal" href="delete_bonds.html">delete_bonds command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dielectric.html">dielectric command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dihedral_coeff.html">dihedral_coeff command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dihedral_style.html">dihedral_style command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dimension.html">dimension command</a></li>
<li class="toctree-l2"><a class="reference internal" href="displace_atoms.html">displace_atoms command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dump.html">dump command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dump.html#dump-vtk-command"><span class="xref std std-doc">dump vtk</span> command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dump.html#dump-h5md-command"><span class="xref std std-doc">dump h5md</span> command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dump.html#dump-molfile-command"><span class="xref std std-doc">dump molfile</span> command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dump.html#dump-netcdf-command"><span class="xref std std-doc">dump netcdf</span> command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dump.html#dump-image-command"><span class="xref std std-doc">dump image</span> command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dump.html#dump-movie-command"><span class="xref std std-doc">dump movie</span> command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dump.html#dump-atom-adios-command"><span class="xref std std-doc">dump atom/adios</span> command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dump.html#dump-custom-adios-command"><span class="xref std std-doc">dump custom/adios</span> command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dump_adios.html">dump atom/adios  command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dump_adios.html#dump-custom-adios-command">dump custom/adios command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dump_cfg_uef.html">dump cfg/uef command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dump_h5md.html">dump h5md command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dump_image.html">dump image command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dump_image.html#dump-movie-command">dump movie command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dump_modify.html">dump_modify command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dump_molfile.html">dump molfile command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dump_netcdf.html">dump netcdf command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dump_netcdf.html#dump-netcdf-mpiio-command">dump netcdf/mpiio command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dump_vtk.html">dump vtk command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dynamical_matrix.html">dynamical_matrix command</a></li>
<li class="toctree-l2"><a class="reference internal" href="echo.html">echo command</a></li>
<li class="toctree-l2"><a class="reference internal" href="fix.html">fix command</a></li>
<li class="toctree-l2"><a class="reference internal" href="fix_modify.html">fix_modify command</a></li>
<li class="toctree-l2"><a class="reference internal" href="group.html">group command</a></li>
<li class="toctree-l2"><a class="reference internal" href="group2ndx.html">group2ndx command</a></li>
<li class="toctree-l2"><a class="reference internal" href="group2ndx.html#ndx2group-command">ndx2group command</a></li>
<li class="toctree-l2"><a class="reference internal" href="hyper.html">hyper command</a></li>
<li class="toctree-l2"><a class="reference internal" href="if.html">if command</a></li>
<li class="toctree-l2"><a class="reference internal" href="improper_coeff.html">improper_coeff command</a></li>
<li class="toctree-l2"><a class="reference internal" href="improper_style.html">improper_style command</a></li>
<li class="toctree-l2"><a class="reference internal" href="include.html">include command</a></li>
<li class="toctree-l2"><a class="reference internal" href="info.html">info command</a></li>
<li class="toctree-l2"><a class="reference internal" href="jump.html">jump command</a></li>
<li class="toctree-l2"><a class="reference internal" href="kim_commands.html"><span class="xref std std-ref">kim_init</span> command</a></li>
<li class="toctree-l2"><a class="reference internal" href="kim_commands.html#kim-interactions-command"><span class="xref std std-ref">kim_interactions</span> command</a></li>
<li class="toctree-l2"><a class="reference internal" href="kim_commands.html#kim-query-command"><span class="xref std std-ref">kim_query</span> command</a></li>
<li class="toctree-l2"><a class="reference internal" href="kim_commands.html#kim-param-command"><span class="xref std std-ref">kim_param</span> command</a></li>
<li class="toctree-l2"><a class="reference internal" href="kim_commands.html#kim-property-command"><span class="xref std std-ref">kim_property</span> command</a></li>
<li class="toctree-l2"><a class="reference internal" href="kspace_modify.html">kspace_modify command</a></li>
<li class="toctree-l2"><a class="reference internal" href="kspace_style.html">kspace_style command</a></li>
<li class="toctree-l2"><a class="reference internal" href="label.html">label command</a></li>
<li class="toctree-l2"><a class="reference internal" href="lattice.html">lattice command</a></li>
<li class="toctree-l2"><a class="reference internal" href="log.html">log command</a></li>
<li class="toctree-l2"><a class="reference internal" href="mass.html">mass command</a></li>
<li class="toctree-l2"><a class="reference internal" href="message.html">message command</a></li>
<li class="toctree-l2"><a class="reference internal" href="min_modify.html">min_modify command</a></li>
<li class="toctree-l2"><a class="reference internal" href="min_spin.html">min_style spin command</a></li>
<li class="toctree-l2"><a class="reference internal" href="min_spin.html#min-style-spin-cg-command">min_style spin/cg command</a></li>
<li class="toctree-l2"><a class="reference internal" href="min_spin.html#min-style-spin-lbfgs-command">min_style spin/lbfgs command</a></li>
<li class="toctree-l2"><a class="reference internal" href="min_style.html">min_style command</a></li>
<li class="toctree-l2"><a class="reference internal" href="minimize.html">minimize command</a></li>
<li class="toctree-l2"><a class="reference internal" href="minimize.html#minimize-kk-command">minimize/kk command</a></li>
<li class="toctree-l2"><a class="reference internal" href="molecule.html">molecule command</a></li>
<li class="toctree-l2"><a class="reference internal" href="neb.html">neb command</a></li>
<li class="toctree-l2"><a class="reference internal" href="neb_spin.html">neb/spin command</a></li>
<li class="toctree-l2"><a class="reference internal" href="neigh_modify.html">neigh_modify command</a></li>
<li class="toctree-l2"><a class="reference internal" href="neighbor.html">neighbor command</a></li>
<li class="toctree-l2"><a class="reference internal" href="newton.html">newton command</a></li>
<li class="toctree-l2"><a class="reference internal" href="next.html">next command</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">package command</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#syntax">Syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="#examples">Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#description">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#restrictions">Restrictions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#related-commands">Related commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="#default">Default</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="pair_coeff.html">pair_coeff command</a></li>
<li class="toctree-l2"><a class="reference internal" href="pair_modify.html">pair_modify command</a></li>
<li class="toctree-l2"><a class="reference internal" href="pair_style.html">pair_style command</a></li>
<li class="toctree-l2"><a class="reference internal" href="pair_write.html">pair_write command</a></li>
<li class="toctree-l2"><a class="reference internal" href="partition.html">partition command</a></li>
<li class="toctree-l2"><a class="reference internal" href="prd.html">prd command</a></li>
<li class="toctree-l2"><a class="reference internal" href="print.html">print command</a></li>
<li class="toctree-l2"><a class="reference internal" href="processors.html">processors command</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html">python command</a></li>
<li class="toctree-l2"><a class="reference internal" href="quit.html">quit command</a></li>
<li class="toctree-l2"><a class="reference internal" href="read_data.html">read_data command</a></li>
<li class="toctree-l2"><a class="reference internal" href="read_dump.html">read_dump command</a></li>
<li class="toctree-l2"><a class="reference internal" href="read_restart.html">read_restart command</a></li>
<li class="toctree-l2"><a class="reference internal" href="region.html">region command</a></li>
<li class="toctree-l2"><a class="reference internal" href="replicate.html">replicate command</a></li>
<li class="toctree-l2"><a class="reference internal" href="rerun.html">rerun command</a></li>
<li class="toctree-l2"><a class="reference internal" href="reset_atom_ids.html">reset_atom_ids command</a></li>
<li class="toctree-l2"><a class="reference internal" href="reset_mol_ids.html">reset_mol_ids command</a></li>
<li class="toctree-l2"><a class="reference internal" href="reset_timestep.html">reset_timestep command</a></li>
<li class="toctree-l2"><a class="reference internal" href="restart.html">restart command</a></li>
<li class="toctree-l2"><a class="reference internal" href="run.html">run command</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_style.html">run_style command</a></li>
<li class="toctree-l2"><a class="reference internal" href="server.html">server command</a></li>
<li class="toctree-l2"><a class="reference internal" href="server_mc.html">server mc command</a></li>
<li class="toctree-l2"><a class="reference internal" href="server_md.html">server md command</a></li>
<li class="toctree-l2"><a class="reference internal" href="set.html">set command</a></li>
<li class="toctree-l2"><a class="reference internal" href="shell.html">shell command</a></li>
<li class="toctree-l2"><a class="reference internal" href="special_bonds.html">special_bonds command</a></li>
<li class="toctree-l2"><a class="reference internal" href="suffix.html">suffix command</a></li>
<li class="toctree-l2"><a class="reference internal" href="tad.html">tad command</a></li>
<li class="toctree-l2"><a class="reference internal" href="temper.html">temper command</a></li>
<li class="toctree-l2"><a class="reference internal" href="temper_grem.html">temper/grem command</a></li>
<li class="toctree-l2"><a class="reference internal" href="temper_npt.html">temper/npt command</a></li>
<li class="toctree-l2"><a class="reference internal" href="thermo.html">thermo command</a></li>
<li class="toctree-l2"><a class="reference internal" href="thermo_modify.html">thermo_modify command</a></li>
<li class="toctree-l2"><a class="reference internal" href="thermo_style.html">thermo_style command</a></li>
<li class="toctree-l2"><a class="reference internal" href="third_order.html">third_order command</a></li>
<li class="toctree-l2"><a class="reference internal" href="timer.html">timer command</a></li>
<li class="toctree-l2"><a class="reference internal" href="timestep.html">timestep command</a></li>
<li class="toctree-l2"><a class="reference internal" href="uncompute.html">uncompute command</a></li>
<li class="toctree-l2"><a class="reference internal" href="undump.html">undump command</a></li>
<li class="toctree-l2"><a class="reference internal" href="unfix.html">unfix command</a></li>
<li class="toctree-l2"><a class="reference internal" href="units.html">units command</a></li>
<li class="toctree-l2"><a class="reference internal" href="variable.html">variable command</a></li>
<li class="toctree-l2"><a class="reference internal" href="velocity.html">velocity command</a></li>
<li class="toctree-l2"><a class="reference internal" href="write_coeff.html">write_coeff command</a></li>
<li class="toctree-l2"><a class="reference internal" href="write_data.html">write_data command</a></li>
<li class="toctree-l2"><a class="reference internal" href="write_dump.html">write_dump command</a></li>
<li class="toctree-l2"><a class="reference internal" href="write_restart.html">write_restart command</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fixes.html">Fixes</a></li>
<li class="toctree-l1"><a class="reference internal" href="computes.html">Computes</a></li>
<li class="toctree-l1"><a class="reference internal" href="pairs.html">Pair Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="bonds.html">Bond Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="angles.html">Angle Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="dihedrals.html">Dihedral Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="impropers.html">Improper Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="fix_modify_atc_commands.html">fix_modify AtC commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="Bibliography.html">Bibliography</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="Manual.html">LAMMPS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="Manual.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="commands_list.html">Commands</a> &raquo;</li>
        
      <li>package command</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
          <a href="http://lammps.sandia.gov">Website</a>
          <a href="Commands_all.html">Commands</a>
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="pair_coeff.html" class="btn btn-neutral float-right" title="pair_coeff command" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="next.html" class="btn btn-neutral float-left" title="next command" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="package-command">
<span id="index-0"></span><h1>package command<a class="headerlink" href="#package-command" title="Permalink to this headline">¶</a></h1>
<div class="section" id="syntax">
<h2>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h2>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>package style args
</pre></div>
</div>
<ul>
<li><p>style = <em>gpu</em> or <em>intel</em> or <em>kokkos</em> or <em>omp</em></p></li>
<li><p>args = arguments specific to the style</p>
<pre class="literal-block"><em>gpu</em> args = Ngpu keyword value ...
  Ngpu = # of GPUs per node
  zero or more keyword/value pairs may be appended
  keywords = <em>neigh</em> or <em>newton</em> or <em>pair/only</em> or <em>binsize</em> or <em>split</em> or <em>gpuID</em> or <em>tpa</em> or <em>device</em> or <em>blocksize</em>
    <em>neigh</em> value = <em>yes</em> or <em>no</em>
      yes = neighbor list build on GPU (default)
      no = neighbor list build on CPU
    <em>newton</em> = <em>off</em> or <em>on</em>
      off = set Newton pairwise flag off (default and required)
      on = set Newton pairwise flag on (currently not allowed)
    <em>pair/only</em> = <em>off</em> or <em>on</em>
      off = apply &quot;gpu&quot; suffix to all available styles in the GPU package (default)
      on  - apply &quot;gpu&quot; suffix only pair styles
    <em>binsize</em> value = size
      size = bin size for neighbor list construction (distance units)
    <em>split</em> = fraction
      fraction = fraction of atoms assigned to GPU (default = 1.0)
    <em>gpuID</em> values = first last
      first = ID of first GPU to be used on each node
      last = ID of last GPU to be used on each node
    <em>tpa</em> value = Nthreads
      Nthreads = # of GPU threads used per atom
    <em>device</em> value = device_type or platform_id:device_type or platform_id:custom,val1,val2,val3,..,val13
      platform_id = numerical OpenCL platform id (default: -1)
      device_type = <em>kepler</em> or <em>fermi</em> or <em>cypress</em> or <em>intel</em> or <em>phi</em> or <em>generic</em> or <em>custom</em>
      val1,val2,... = custom OpenCL tune parameters (see below for details)
    <em>blocksize</em> value = size
      size = thread block size for pair force computation
<em>intel</em> args = NPhi keyword value ...
  Nphi = # of co-processors per node
  zero or more keyword/value pairs may be appended
  keywords = <em>mode</em> or <em>omp</em> or <em>lrt</em> or <em>balance</em> or <em>ghost</em> or <em>tpc</em> or <em>tptask</em> or <em>no_affinity</em>
    <em>mode</em> value = <em>single</em> or <em>mixed</em> or <em>double</em>
      single = perform force calculations in single precision
      mixed = perform force calculations in mixed precision
      double = perform force calculations in double precision
    <em>omp</em> value = Nthreads
      Nthreads = number of OpenMP threads to use on CPU (default = 0)
    <em>lrt</em> value = <em>yes</em> or <em>no</em>
      yes = use additional thread dedicated for some PPPM calculations
      no = do not dedicate an extra thread for some PPPM calculations
    <em>balance</em> value = split
      split = fraction of work to offload to co-processor, -1 for dynamic
    <em>ghost</em> value = <em>yes</em> or <em>no</em>
      yes = include ghost atoms for offload
      no = do not include ghost atoms for offload
    <em>tpc</em> value = Ntpc
      Ntpc = max number of co-processor threads per co-processor core (default = 4)
    <em>tptask</em> value = Ntptask
      Ntptask = max number of co-processor threads per MPI task (default = 240)
    <em>no_affinity</em> values = none
<em>kokkos</em> args = keyword value ...
  zero or more keyword/value pairs may be appended
  keywords = <em>neigh</em> or <em>neigh/qeq</em> or <em>neigh/thread</em> or <em>newton</em> or <em>binsize</em> or <em>comm</em> or <em>comm/exchange</em> or <em>comm/forward</em> <em>pair/comm/forward</em> <em>fix/comm/forward</em> or <em>comm/reverse</em> or <em>gpu/aware</em> or <em>pair/only</em>
    <em>neigh</em> value = <em>full</em> or <em>half</em>
      full = full neighbor list
      half = half neighbor list built in thread-safe manner
    <em>neigh/qeq</em> value = <em>full</em> or <em>half</em>
      full = full neighbor list
      half = half neighbor list built in thread-safe manner
    <em>neigh/thread</em> value = <em>off</em> or <em>on</em>
      off = thread only over atoms
      on = thread over both atoms and neighbors
    <em>newton</em> = <em>off</em> or <em>on</em>
      off = set Newton pairwise and bonded flags off
      on = set Newton pairwise and bonded flags on
    <em>binsize</em> value = size
      size = bin size for neighbor list construction (distance units)
    <em>comm</em> value = <em>no</em> or <em>host</em> or <em>device</em>
      use value for comm/exchange and comm/forward and pair/comm/forward and fix/comm/forward and comm/reverse
    <em>comm/exchange</em> value = <em>no</em> or <em>host</em> or <em>device</em>
    <em>comm/forward</em> value = <em>no</em> or <em>host</em> or <em>device</em>
    <em>pair/comm/forward</em> value = <em>no</em> or <em>device</em>
    <em>fix/comm/forward</em> value = <em>no</em> or <em>device</em>
    <em>comm/reverse</em> value = <em>no</em> or <em>host</em> or <em>device</em>
      no = perform communication pack/unpack in non-KOKKOS mode
      host = perform pack/unpack on host (e.g. with OpenMP threading)
      device = perform pack/unpack on device (e.g. on GPU)
    <em>gpu/aware</em> = <em>off</em> or <em>on</em>
      off = do not use GPU-aware MPI
      on = use GPU-aware MPI (default)
    <em>pair/only</em> = <em>off</em> or <em>on</em>
      off = use device acceleration (e.g. GPU) for all available styles in the KOKKOS package (default)
      on  = use device acceleration only for pair styles (and host acceleration for others)
<em>omp</em> args = Nthreads keyword value ...
  Nthread = # of OpenMP threads to associate with each MPI process
  zero or more keyword/value pairs may be appended
  keywords = <em>neigh</em>
    <em>neigh</em> value = <em>yes</em> or <em>no</em>
      yes = threaded neighbor list build (default)
      no = non-threaded neighbor list build</pre>
</li>
</ul>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<div class="highlight-LAMMPS notranslate"><div class="highlight"><pre><span></span><span class="k">package</span><span class="w"> </span><span class="n">gpu</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
<span class="k">package</span><span class="w"> </span><span class="n">gpu</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="n">split</span><span class="w"> </span><span class="m">0.75</span><span class="w"></span>
<span class="k">package</span><span class="w"> </span><span class="n">gpu</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="n">split</span><span class="w"> </span><span class="o">-</span><span class="m">1.0</span><span class="w"></span>
<span class="k">package</span><span class="w"> </span><span class="n">gpu</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="n">kepler</span><span class="w"></span>
<span class="k">package</span><span class="w"> </span><span class="n">gpu</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="m">2</span><span class="err">:</span><span class="n">generic</span><span class="w"></span>
<span class="k">package</span><span class="w"> </span><span class="n">gpu</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="n">custom</span><span class="err">,</span><span class="m">32</span><span class="err">,</span><span class="m">4</span><span class="err">,</span><span class="m">8</span><span class="err">,</span><span class="m">256</span><span class="err">,</span><span class="m">11</span><span class="err">,</span><span class="m">128</span><span class="err">,</span><span class="m">256</span><span class="err">,</span><span class="m">128</span><span class="err">,</span><span class="m">32</span><span class="err">,</span><span class="m">64</span><span class="err">,</span><span class="m">8</span><span class="err">,</span><span class="m">128</span><span class="err">,</span><span class="m">128</span><span class="w"></span>
<span class="k">package</span><span class="w"> </span><span class="n">kokkos</span><span class="w"> </span><span class="n">neigh</span><span class="w"> </span><span class="n">half</span><span class="w"> </span><span class="n">comm</span><span class="w"> </span><span class="n">device</span><span class="w"></span>
<span class="k">package</span><span class="w"> </span><span class="n">omp</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="n">neigh</span><span class="w"> </span><span class="n">no</span><span class="w"></span>
<span class="k">package</span><span class="w"> </span><span class="n">omp</span><span class="w"> </span><span class="m">4</span><span class="w"></span>
<span class="k">package</span><span class="w"> </span><span class="n">intel</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
<span class="k">package</span><span class="w"> </span><span class="n">intel</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="n">omp</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">mixed</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="m">0.5</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This command invokes package-specific settings for the various
accelerator packages available in LAMMPS.  Currently the following
packages use settings from this command: GPU, USER-INTEL, KOKKOS, and
USER-OMP.</p>
<p>If this command is specified in an input script, it must be near the
top of the script, before the simulation box has been defined.  This
is because it specifies settings that the accelerator packages use in
their initialization, before a simulation is defined.</p>
<p>This command can also be specified from the command-line when
launching LAMMPS, using the “-pk” <a class="reference internal" href="Run_options.html"><span class="doc">command-line switch</span></a>.  The syntax is exactly the same as when used
in an input script.</p>
<p>Note that all of the accelerator packages require the package command
to be specified (except the OPT package), if the package is to be used
in a simulation (LAMMPS can be built with an accelerator package
without using it in a particular simulation).  However, in all cases,
a default version of the command is typically invoked by other
accelerator settings.</p>
<p>The KOKKOS package requires a “-k on” <a class="reference internal" href="Run_options.html"><span class="doc">command-line switch</span></a> respectively, which invokes a “package
kokkos” command with default settings.</p>
<p>For the GPU, USER-INTEL, and USER-OMP packages, if a “-sf gpu” or “-sf
intel” or “-sf omp” <a class="reference internal" href="Run_options.html"><span class="doc">command-line switch</span></a> is used to
auto-append accelerator suffixes to various styles in the input
script, then those switches also invoke a “package gpu”, “package
intel”, or “package omp” command with default settings.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A package command for a particular style can be invoked multiple
times when a simulation is setup, e.g. by the <a class="reference internal" href="Run_options.html"><span class="doc">-c on, -k on, -sf, and -pk command-line switches</span></a>, and by using this command
in an input script.  Each time it is used all of the style options are
set, either to default values or to specified settings.  I.e. settings
from previous invocations do not persist across multiple invocations.</p>
</div>
<p>See the <a class="reference internal" href="Speed_packages.html"><span class="doc">Speed packages</span></a> doc page for more details
about using the various accelerator packages for speeding up LAMMPS
simulations.</p>
<hr class="docutils" />
<p>The <em>gpu</em> style invokes settings associated with the use of the GPU
package.</p>
<p>The <em>Ngpu</em> argument sets the number of GPUs per node.  There must be
at least as many MPI tasks per node as GPUs, as set by the mpirun or
mpiexec command.  If there are more MPI tasks (per node)
than GPUs, multiple MPI tasks will share each GPU.</p>
<p>Optional keyword/value pairs can also be specified.  Each has a
default value as listed below.</p>
<p>The <em>neigh</em> keyword specifies where neighbor lists for pair style
computation will be built.  If <em>neigh</em> is <em>yes</em>, which is the default,
neighbor list building is performed on the GPU.  If <em>neigh</em> is <em>no</em>,
neighbor list building is performed on the CPU.  GPU neighbor list
building currently cannot be used with a triclinic box.  GPU neighbor
lists are not compatible with commands that are not GPU-enabled.  When
a non-GPU enabled command requires a neighbor list, it will also be
built on the CPU.  In these cases, it will typically be more efficient
to only use CPU neighbor list builds.</p>
<p>The <em>newton</em> keyword sets the Newton flags for pairwise (not bonded)
interactions to <em>off</em> or <em>on</em>, the same as the <a class="reference internal" href="newton.html"><span class="doc">newton</span></a>
command allows.  Currently, only an <em>off</em> value is allowed, since all
the GPU package pair styles require this setting.  This means more
computation is done, but less communication.  In the future a value of
<em>on</em> may be allowed, so the <em>newton</em> keyword is included as an option
for compatibility with the package command for other accelerator
styles.  Note that the newton setting for bonded interactions is not
affected by this keyword.</p>
<p>The <em>pair/only</em> keyword can change how any “gpu” suffix is applied.
By default a suffix is applied to all styles for which an accelerated
variant is available.  However, that is not always the most effective
way to use an accelerator.  With <em>pair/only</em> set to <em>on</em> the suffix
will only by applied to supported pair styles, which tend to be the
most effective in using an accelerator and their operation can be
overlapped with all other computations on the CPU.</p>
<p>The <em>binsize</em> keyword sets the size of bins used to bin atoms in
neighbor list builds performed on the GPU, if <em>neigh</em> = <em>yes</em> is set.
If <em>binsize</em> is set to 0.0 (the default), then bins = the size of the
pairwise cutoff + neighbor skin distance.  This is 2x larger than the
LAMMPS default used for neighbor list building on the CPU.  This will
be close to optimal for the GPU, so you do not normally need to use
this keyword.  Note that if you use a longer-than-usual pairwise
cutoff, e.g. to allow for a smaller fraction of KSpace work with a
<a class="reference internal" href="kspace_style.html"><span class="doc">long-range Coulombic solver</span></a> because the GPU is
faster at performing pairwise interactions, then it may be optimal to
make the <em>binsize</em> smaller than the default.  For example, with a
cutoff of 20*sigma in LJ <a class="reference internal" href="units.html"><span class="doc">units</span></a> and a neighbor skin
distance of sigma, a <em>binsize</em> = 5.25*sigma can be more efficient than
the default.</p>
<p>The <em>split</em> keyword can be used for load balancing force calculations
between CPU and GPU cores in GPU-enabled pair styles. If 0 &lt; <em>split</em> &lt;
1.0, a fixed fraction of particles is offloaded to the GPU while force
calculation for the other particles occurs simultaneously on the CPU.
If <em>split</em> &lt; 0.0, the optimal fraction (based on CPU and GPU timings)
is calculated every 25 timesteps, i.e. dynamic load-balancing across
the CPU and GPU is performed.  If <em>split</em> = 1.0, all force
calculations for GPU accelerated pair styles are performed on the GPU.
In this case, other <a class="reference internal" href="pair_hybrid.html"><span class="doc">hybrid</span></a> pair interactions,
<a class="reference internal" href="bond_style.html"><span class="doc">bond</span></a>, <a class="reference internal" href="angle_style.html"><span class="doc">angle</span></a>,
<a class="reference internal" href="dihedral_style.html"><span class="doc">dihedral</span></a>, <a class="reference internal" href="improper_style.html"><span class="doc">improper</span></a>, and
<a class="reference internal" href="kspace_style.html"><span class="doc">long-range</span></a> calculations can be performed on the
CPU while the GPU is performing force calculations for the GPU-enabled
pair style.  If all CPU force computations complete before the GPU
completes, LAMMPS will block until the GPU has finished before
continuing the timestep.</p>
<p>As an example, if you have two GPUs per node and 8 CPU cores per node,
and would like to run on 4 nodes (32 cores) with dynamic balancing of
force calculation across CPU and GPU cores, you could specify</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpirun -np <span class="m">32</span> -sf gpu -in <span class="k">in</span>.script    <span class="c1"># launch command</span>
package gpu <span class="m">2</span> split -1                 <span class="c1"># input script command</span>
</pre></div>
</div>
<p>In this case, all CPU cores and GPU devices on the nodes would be
utilized.  Each GPU device would be shared by 4 CPU cores. The CPU
cores would perform force calculations for some fraction of the
particles at the same time the GPUs performed force calculation for
the other particles.</p>
<p>The <em>gpuID</em> keyword allows selection of which GPUs on each node will
be used for a simulation.  The <em>first</em> and <em>last</em> values specify the
GPU IDs to use (from 0 to Ngpu-1).  By default, first = 0 and last =
Ngpu-1, so that all GPUs are used, assuming Ngpu is set to the number
of physical GPUs.  If you only wish to use a subset, set Ngpu to a
smaller number and first/last to a sub-range of the available GPUs.</p>
<p>The <em>tpa</em> keyword sets the number of GPU thread per atom used to
perform force calculations.  With a default value of 1, the number of
threads will be chosen based on the pair style, however, the value can
be set explicitly with this keyword to fine-tune performance.  For
large cutoffs or with a small number of particles per GPU, increasing
the value can improve performance. The number of threads per atom must
be a power of 2 and currently cannot be greater than 32.</p>
<p>The <em>device</em> keyword can be used to tune parameters optimized for a
specific accelerator and platform when using OpenCL. OpenCL supports
the concept of a <strong>platform</strong>, which represents one or more devices that
share the same driver (e.g. there would be a different platform for
GPUs from different vendors or for CPU based accelerator support).
In LAMMPS only one platform can be active at a time and by default
the first platform with an accelerator is selected. This is equivalent
to using a platform ID of -1. The platform ID is a number corresponding
to the output of the ocl_get_devices tool. The platform ID is passed
to the GPU library, by prefixing the <em>device</em> keyword with that number
separated by a colon. For CUDA, the <em>device</em> keyword is ignored.
Currently, the device tuning support is limited to NVIDIA Kepler, NVIDIA
Fermi, AMD Cypress, Intel x86_64 CPU, Intel Xeon Phi, or a generic device.
More devices may be added later.  The default device type can be
specified when building LAMMPS with the GPU library, via setting a
variable in the lib/gpu/Makefile that is used.</p>
<p>In addition, a device type <em>custom</em> is available, which is followed by
13 comma separated numbers, which allows to set those tweakable parameters
from the package command. It can be combined with the (colon separated)
platform id. The individual settings are:</p>
<ul class="simple">
<li><p>MEM_THREADS</p></li>
<li><p>THREADS_PER_ATOM</p></li>
<li><p>THREADS_PER_CHARGE</p></li>
<li><p>BLOCK_PAIR</p></li>
<li><p>MAX_SHARED_TYPES</p></li>
<li><p>BLOCK_NBOR_BUILD</p></li>
<li><p>BLOCK_BIO_PAIR</p></li>
<li><p>BLOCK_ELLIPSE</p></li>
<li><p>WARP_SIZE</p></li>
<li><p>PPPM_BLOCK_1D</p></li>
<li><p>BLOCK_CELL_2D</p></li>
<li><p>BLOCK_CELL_ID</p></li>
<li><p>MAX_BIO_SHARED_TYPES</p></li>
</ul>
<p>The <em>blocksize</em> keyword allows you to tweak the number of threads used
per thread block. This number should be a multiple of 32 (for GPUs)
and its maximum depends on the specific GPU hardware. Typical choices
are 64, 128, or 256. A larger block size increases occupancy of
individual GPU cores, but reduces the total number of thread blocks,
thus may lead to load imbalance.</p>
<hr class="docutils" />
<p>The <em>intel</em> style invokes settings associated with the use of the
USER-INTEL package.  All of its settings, except the <em>omp</em> and <em>mode</em>
keywords, are ignored if LAMMPS was not built with Xeon Phi
co-processor support.  All of its settings, including the <em>omp</em> and
<em>mode</em> keyword are applicable if LAMMPS was built with co-processor
support.</p>
<p>The <em>Nphi</em> argument sets the number of co-processors per node.
This can be set to any value, including 0, if LAMMPS was not
built with co-processor support.</p>
<p>Optional keyword/value pairs can also be specified.  Each has a
default value as listed below.</p>
<p>The <em>omp</em> keyword determines the number of OpenMP threads allocated
for each MPI task when any portion of the interactions computed by a
USER-INTEL pair style are run on the CPU.  This can be the case even
if LAMMPS was built with co-processor support; see the <em>balance</em>
keyword discussion below.  If you are running with less MPI tasks/node
than there are CPUs, it can be advantageous to use OpenMP threading on
the CPUs.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <em>omp</em> keyword has nothing to do with co-processor threads on
the Xeon Phi; see the <em>tpc</em> and <em>tptask</em> keywords below for a
discussion of co-processor threads.</p>
</div>
<p>The <em>Nthread</em> value for the <em>omp</em> keyword sets the number of OpenMP
threads allocated for each MPI task.  Setting <em>Nthread</em> = 0 (the
default) instructs LAMMPS to use whatever value is the default for the
given OpenMP environment. This is usually determined via the
<em>OMP_NUM_THREADS</em> environment variable or the compiler runtime, which
is usually a value of 1.</p>
<p>For more details, including examples of how to set the OMP_NUM_THREADS
environment variable, see the discussion of the <em>Nthreads</em> setting on
this doc page for the “package omp” command.  Nthreads is a required
argument for the USER-OMP package.  Its meaning is exactly the same
for the USER-INTEL package.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you build LAMMPS with both the USER-INTEL and USER-OMP
packages, be aware that both packages allow setting of the <em>Nthreads</em>
value via their package commands, but there is only a single global
<em>Nthreads</em> value used by OpenMP.  Thus if both package commands are
invoked, you should insure the two values are consistent.  If they are
not, the last one invoked will take precedence, for both packages.
Also note that if the <a class="reference internal" href="Run_options.html"><span class="doc">-sf hybrid intel omp command-line switch</span></a> is used, it invokes a “package intel”
command, followed by a “package omp” command, both with a setting of
<em>Nthreads</em> = 0.</p>
</div>
<p>The <em>mode</em> keyword determines the precision mode to use for
computing pair style forces, either on the CPU or on the co-processor,
when using a USER-INTEL supported <a class="reference internal" href="pair_style.html"><span class="doc">pair style</span></a>.  It
can take a value of <em>single</em>, <em>mixed</em> which is the default, or
<em>double</em>.  <em>Single</em> means single precision is used for the entire
force calculation.  <em>Mixed</em> means forces between a pair of atoms are
computed in single precision, but accumulated and stored in double
precision, including storage of forces, torques, energies, and virial
quantities.  <em>Double</em> means double precision is used for the entire
force calculation.</p>
<p>The <em>lrt</em> keyword can be used to enable “Long Range Thread (LRT)”
mode. It can take a value of <em>yes</em> to enable and <em>no</em> to disable.
LRT mode generates an extra thread (in addition to any OpenMP threads
specified with the OMP_NUM_THREADS environment variable or the <em>omp</em>
keyword). The extra thread is dedicated for performing part of the
<a class="reference internal" href="kspace_style.html"><span class="doc">PPPM solver</span></a> computations and communications. This
can improve parallel performance on processors supporting
Simultaneous Multithreading (SMT) such as Hyper-Threading (HT) on Intel
processors. In this mode, one additional thread is generated per MPI
process. LAMMPS will generate a warning in the case that more threads
are used than available in SMT hardware on a node. If the PPPM solver
from the USER-INTEL package is not used, then the LRT setting is
ignored and no extra threads are generated. Enabling LRT will replace
the <a class="reference internal" href="run_style.html"><span class="doc">run_style</span></a> with the <em>verlet/lrt/intel</em> style that
is identical to the default <em>verlet</em> style aside from supporting the
LRT feature. This feature requires setting the pre-processor flag
-DLMP_INTEL_USELRT in the makefile when compiling LAMMPS.</p>
<p>The <em>balance</em> keyword sets the fraction of <a class="reference internal" href="pair_style.html"><span class="doc">pair style</span></a> work offloaded to the co-processor for split
values between 0.0 and 1.0 inclusive.  While this fraction of work is
running on the co-processor, other calculations will run on the host,
including neighbor and pair calculations that are not offloaded, as
well as angle, bond, dihedral, kspace, and some MPI communications.
If <em>split</em> is set to -1, the fraction of work is dynamically adjusted
automatically throughout the run.  This typically give performance
within 5 to 10 percent of the optimal fixed fraction.</p>
<p>The <em>ghost</em> keyword determines whether or not ghost atoms, i.e. atoms
at the boundaries of processor sub-domains, are offloaded for neighbor
and force calculations.  When the value = “no”, ghost atoms are not
offloaded.  This option can reduce the amount of data transfer with
the co-processor and can also overlap MPI communication of forces with
computation on the co-processor when the <a class="reference internal" href="newton.html"><span class="doc">newton pair</span></a>
setting is “on”.  When the value = “yes”, ghost atoms are offloaded.
In some cases this can provide better performance, especially if the
<em>balance</em> fraction is high.</p>
<p>The <em>tpc</em> keyword sets the max # of co-processor threads <em>Ntpc</em> that
will run on each core of the co-processor.  The default value = 4,
which is the number of hardware threads per core supported by the
current generation Xeon Phi chips.</p>
<p>The <em>tptask</em> keyword sets the max # of co-processor threads (Ntptask*
assigned to each MPI task.  The default value = 240, which is the
total # of threads an entire current generation Xeon Phi chip can run
(240 = 60 cores * 4 threads/core).  This means each MPI task assigned
to the Phi will enough threads for the chip to run the max allowed,
even if only 1 MPI task is assigned.  If 8 MPI tasks are assigned to
the Phi, each will run with 30 threads.  If you wish to limit the
number of threads per MPI task, set <em>tptask</em> to a smaller value.
E.g. for <em>tptask</em> = 16, if 8 MPI tasks are assigned, each will run
with 16 threads, for a total of 128.</p>
<p>Note that the default settings for <em>tpc</em> and <em>tptask</em> are fine for
most problems, regardless of how many MPI tasks you assign to a Phi.</p>
<p>The <em>no_affinity</em> keyword will turn off automatic setting of core
affinity for MPI tasks and OpenMP threads on the host when using
offload to a co-processor. Affinity settings are used when possible
to prevent MPI tasks and OpenMP threads from being on separate NUMA
domains and to prevent offload threads from interfering with other
processes/threads used for LAMMPS.</p>
<hr class="docutils" />
<p>The <em>kokkos</em> style invokes settings associated with the use of the
KOKKOS package.</p>
<p>All of the settings are optional keyword/value pairs. Each has a default
value as listed below.</p>
<p>The <em>neigh</em> keyword determines how neighbor lists are built. A value of
<em>half</em> uses a thread-safe variant of half-neighbor lists, the same as
used by most pair styles in LAMMPS, which is the default when running on
CPUs (i.e. the Kokkos CUDA back end is not enabled).</p>
<p>A value of <em>full</em> uses a full neighbor lists and is the default when
running on GPUs. This performs twice as much computation as the <em>half</em>
option, however that is often a win because it is thread-safe and
does not require atomic operations in the calculation of pair forces. For
that reason, <em>full</em> is the default setting for GPUs. However, when
running on CPUs, a <em>half</em> neighbor list is the default because it are
often faster, just as it is for non-accelerated pair styles. Similarly,
the <em>neigh/qeq</em> keyword determines how neighbor lists are built for <a class="reference internal" href="fix_qeq_reax.html"><span class="doc">fix qeq/reax/kk</span></a>.</p>
<p>If the <em>neigh/thread</em> keyword is set to <em>off</em>, then the KOKKOS package
threads only over atoms. However, for small systems, this may not expose
enough parallelism to keep a GPU busy. When this keyword is set to <em>on</em>,
the KOKKOS package threads over both atoms and neighbors of atoms. When
using <em>neigh/thread</em> <em>on</em>, a full neighbor list must also be used. Using
<em>neigh/thread</em> <em>on</em> may be slower for large systems, so this this option
is turned on by default only when there are 16K atoms or less owned by
an MPI rank and when using a full neighbor list. Not all KOKKOS-enabled
potentials support this keyword yet, and only thread over atoms. Many
simple pair-wise potentials such as Lennard-Jones do support threading
over both atoms and neighbors.</p>
<p>The <em>newton</em> keyword sets the Newton flags for pairwise and bonded
interactions to <em>off</em> or <em>on</em>, the same as the <a class="reference internal" href="newton.html"><span class="doc">newton</span></a>
command allows. The default for GPUs is <em>off</em> because this will almost
always give better performance for the KOKKOS package. This means more
computation is done, but less communication. However, when running on
CPUs a value of <em>on</em> is the default since it can often be faster, just
as it is for non-accelerated pair styles</p>
<p>The <em>binsize</em> keyword sets the size of bins used to bin atoms in
neighbor list builds. The same value can be set by the <a class="reference internal" href="neigh_modify.html"><span class="doc">neigh_modify binsize</span></a> command. Making it an option in the package
kokkos command allows it to be set from the command line. The default
value for CPUs is 0.0, which means the LAMMPS default will be used,
which is bins = 1/2 the size of the pairwise cutoff + neighbor skin
distance. This is fine when neighbor lists are built on the CPU. For GPU
builds, a 2x larger binsize equal to the pairwise cutoff + neighbor skin
is often faster, which is the default. Note that if you use a
longer-than-usual pairwise cutoff, e.g. to allow for a smaller fraction
of KSpace work with a <a class="reference internal" href="kspace_style.html"><span class="doc">long-range Coulombic solver</span></a>
because the GPU is faster at performing pairwise interactions, then this
rule of thumb may give too large a binsize and the default should be
overridden with a smaller value.</p>
<p>The <em>comm</em> and <em>comm/exchange</em> and <em>comm/forward</em> and <em>pair/comm/forward</em>
and <em>fix/comm/forward</em> and comm/reverse*
keywords determine whether the host or device performs the packing and
unpacking of data when communicating per-atom data between processors.
“Exchange” communication happens only on timesteps that neighbor lists
are rebuilt. The data is only for atoms that migrate to new processors.
“Forward” communication happens every timestep. “Reverse” communication
happens every timestep if the <em>newton</em> option is on. The data is for
atom coordinates and any other atom properties that needs to be updated
for ghost atoms owned by each processor. “Pair/comm” controls additional
communication in pair styles, such as pair_style EAM. “Fix/comm” controls
additional communication in fixes, such as fix SHAKE.</p>
<p>The <em>comm</em> keyword is simply a short-cut to set the same value for all
the comm keywords.</p>
<p>The value options for the keywords are <em>no</em> or <em>host</em> or <em>device</em>. A
value of <em>no</em> means to use the standard non-KOKKOS method of
packing/unpacking data for the communication. A value of <em>host</em> means to
use the host, typically a multi-core CPU, and perform the
packing/unpacking in parallel with threads. A value of <em>device</em> means to
use the device, typically a GPU, to perform the packing/unpacking
operation. If a value of <em>host</em> is used for the <em>pair/comm/forward</em> or
<em>fix/comm/forward</em> keyword, it will be automatically be changed to <em>no</em>
since these keywords don’t support <em>host</em> mode.</p>
<p>The optimal choice for these keywords depends on the input script and
the hardware used. The <em>no</em> value is useful for verifying that the
Kokkos-based <em>host</em> and <em>device</em> values are working correctly. It is the
default when running on CPUs since it is usually the fastest.</p>
<p>When running on CPUs or Xeon Phi, the <em>host</em> and <em>device</em> values work
identically. When using GPUs, the <em>device</em> value is the default since it
will typically be optimal if all of your styles used in your input
script are supported by the KOKKOS package. In this case data can stay
on the GPU for many timesteps without being moved between the host and
GPU, if you use the <em>device</em> value. If your script uses styles (e.g.
fixes) which are not yet supported by the KOKKOS package, then data has
to be moved between the host and device anyway, so it is typically faster
to let the host handle communication, by using the <em>host</em> value. Using
<em>host</em> instead of <em>no</em> will enable use of multiple threads to
pack/unpack communicated data. When running small systems on a GPU,
performing the exchange pack/unpack on the host CPU can give speedup
since it reduces the number of CUDA kernel launches.</p>
<p>The <em>gpu/aware</em> keyword chooses whether GPU-aware MPI will be used. When
this keyword is set to <em>on</em>, buffers in GPU memory are passed directly
through MPI send/receive calls. This reduces overhead of first copying
the data to the host CPU. However GPU-aware MPI is not supported on all
systems, which can lead to segmentation faults and would require using a
value of <em>off</em>. If LAMMPS can safely detect that GPU-aware MPI is not
available (currently only possible with OpenMPI v2.0.0 or later), then
the <em>gpu/aware</em> keyword is automatically set to <em>off</em> by default. When
the <em>gpu/aware</em> keyword is set to <em>off</em> while any of the <em>comm</em>
keywords are set to <em>device</em>, the value for these <em>comm</em> keywords will
be automatically changed to <em>no</em>. This setting has no effect if not
running on GPUs or if using only one MPI rank. GPU-aware MPI is available
for OpenMPI 1.8 (or later versions), Mvapich2 1.9 (or later) when the
“MV2_USE_CUDA” environment variable is set to “1”, CrayMPI, and IBM
Spectrum MPI when the “-gpu” flag is used.</p>
<p>The <em>pair/only</em> keyword can change how the KOKKOS suffix “kk” is applied
when using an accelerator device.  By default device acceleration is
always used for all available styles.  With <em>pair/only</em> set to <em>on</em> the
suffix setting will choose device acceleration only for pair styles and
run all other force computations on the host CPU.
The <em>comm</em> flags will also automatically be changed to <em>no</em>. This can
result in better performance for certain configurations and system sizes.</p>
<hr class="docutils" />
<p>The <em>omp</em> style invokes settings associated with the use of the
USER-OMP package.</p>
<p>The <em>Nthread</em> argument sets the number of OpenMP threads allocated for
each MPI task.  For example, if your system has nodes with dual
quad-core processors, it has a total of 8 cores per node.  You could
use two MPI tasks per node (e.g. using the -ppn option of the mpirun
command in MPICH or -npernode in OpenMPI), and set <em>Nthreads</em> = 4.
This would use all 8 cores on each node.  Note that the product of MPI
tasks * threads/task should not exceed the physical number of cores
(on a node), otherwise performance will suffer.</p>
<p>Setting <em>Nthread</em> = 0 instructs LAMMPS to use whatever value is the
default for the given OpenMP environment. This is usually determined
via the <em>OMP_NUM_THREADS</em> environment variable or the compiler
runtime.  Note that in most cases the default for OpenMP capable
compilers is to use one thread for each available CPU core when
<em>OMP_NUM_THREADS</em> is not explicitly set, which can lead to poor
performance.</p>
<p>Here are examples of how to set the environment variable when
launching LAMMPS:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>env <span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">4</span> lmp_machine -sf omp -in <span class="k">in</span>.script
env <span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">2</span> mpirun -np <span class="m">2</span> lmp_machine -sf omp -in <span class="k">in</span>.script
mpirun -x <span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">2</span> -np <span class="m">2</span> lmp_machine -sf omp -in <span class="k">in</span>.script
</pre></div>
</div>
<p>or you can set it permanently in your shell’s start-up script.
All three of these examples use a total of 4 CPU cores.</p>
<p>Note that different MPI implementations have different ways of passing
the OMP_NUM_THREADS environment variable to all MPI processes.  The
second example line above is for MPICH; the third example line with -x is
for OpenMPI.  Check your MPI documentation for additional details.</p>
<p>What combination of threads and MPI tasks gives the best performance
is difficult to predict and can depend on many components of your
input.  Not all features of LAMMPS support OpenMP threading via the
USER-OMP package and the parallel efficiency can be very different,
too.</p>
<p>Optional keyword/value pairs can also be specified.  Each has a
default value as listed below.</p>
<p>The <em>neigh</em> keyword specifies whether neighbor list building will be
multi-threaded in addition to force calculations.  If <em>neigh</em> is set
to <em>no</em> then neighbor list calculation is performed only by MPI tasks
with no OpenMP threading.  If <em>mode</em> is <em>yes</em> (the default), a
multi-threaded neighbor list build is used.  Using <em>neigh</em> = <em>yes</em> is
almost always faster and should produce identical neighbor lists at the
expense of using more memory.  Specifically, neighbor list pages are
allocated for all threads at the same time and each thread works
within its own pages.</p>
</div>
<hr class="docutils" />
<div class="section" id="restrictions">
<h2>Restrictions<a class="headerlink" href="#restrictions" title="Permalink to this headline">¶</a></h2>
<p>This command cannot be used after the simulation box is defined by a
<a class="reference internal" href="read_data.html"><span class="doc">read_data</span></a> or <a class="reference internal" href="create_box.html"><span class="doc">create_box</span></a> command.</p>
<p>The gpu style of this command can only be invoked if LAMMPS was built
with the GPU package.  See the <a class="reference internal" href="Build_package.html"><span class="doc">Build package</span></a> doc
page for more info.</p>
<p>The intel style of this command can only be invoked if LAMMPS was
built with the USER-INTEL package.  See the <a class="reference internal" href="Build_package.html"><span class="doc">Build package</span></a> doc page for more info.</p>
<p>The kk style of this command can only be invoked if LAMMPS was built
with the KOKKOS package.  See the <a class="reference internal" href="Build_package.html"><span class="doc">Build package</span></a>
doc page for more info.</p>
<p>The omp style of this command can only be invoked if LAMMPS was built
with the USER-OMP package.  See the <a class="reference internal" href="Build_package.html"><span class="doc">Build package</span></a>
doc page for more info.</p>
</div>
<div class="section" id="related-commands">
<h2>Related commands<a class="headerlink" href="#related-commands" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="suffix.html"><span class="doc">suffix</span></a>, <a class="reference internal" href="Run_options.html"><span class="doc">-pk command-line switch</span></a></p>
</div>
<div class="section" id="default">
<h2>Default<a class="headerlink" href="#default" title="Permalink to this headline">¶</a></h2>
<p>For the GPU package, the default is Ngpu = 1 and the option defaults
are neigh = yes, newton = off, binsize = 0.0, split = 1.0, gpuID = 0
to Ngpu-1, tpa = 1, and device = not used.  These settings are made
automatically if the “-sf gpu” <a class="reference internal" href="Run_options.html"><span class="doc">command-line switch</span></a>
is used.  If it is not used, you must invoke the package gpu command
in your input script or via the “-pk gpu” <a class="reference internal" href="Run_options.html"><span class="doc">command-line switch</span></a>.</p>
<p>For the USER-INTEL package, the default is Nphi = 1 and the option
defaults are omp = 0, mode = mixed, lrt = no, balance = -1, tpc = 4,
tptask = 240.  The default ghost option is determined by the pair
style being used.  This value is output to the screen in the offload
report at the end of each run.  Note that all of these settings,
except “omp” and “mode”, are ignored if LAMMPS was not built with Xeon
Phi co-processor support.  These settings are made automatically if the
“-sf intel” <a class="reference internal" href="Run_options.html"><span class="doc">command-line switch</span></a> is used.  If it is
not used, you must invoke the package intel command in your input
script or via the “-pk intel” <a class="reference internal" href="Run_options.html"><span class="doc">command-line switch</span></a>.</p>
<p>For the KOKKOS package, the option defaults for GPUs are neigh = full,
neigh/qeq = full, newton = off, binsize for GPUs = 2x LAMMPS default
value, comm = device, gpu/aware = on. When LAMMPS can safely detect
that GPU-aware MPI is not available, the default value of gpu/aware
becomes “off”. For CPUs or Xeon Phis, the option defaults are neigh =
half, neigh/qeq = half, newton = on, binsize = 0.0, and comm = no. The
option neigh/thread = on when there are 16K atoms or less on an MPI
rank, otherwise it is “off”. These settings are made automatically by
the required “-k on” <a class="reference internal" href="Run_options.html"><span class="doc">command-line switch</span></a>. You can
change them by using the package kokkos command in your input script or
via the <a class="reference internal" href="Run_options.html"><span class="doc">-pk kokkos command-line switch</span></a>.</p>
<p>For the OMP package, the default is Nthreads = 0 and the option
defaults are neigh = yes.  These settings are made automatically if
the “-sf omp” <a class="reference internal" href="Run_options.html"><span class="doc">command-line switch</span></a> is used.  If it
is not used, you must invoke the package omp command in your input
script or via the “-pk omp” <a class="reference internal" href="Run_options.html"><span class="doc">command-line switch</span></a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="pair_coeff.html" class="btn btn-neutral float-right" title="pair_coeff command" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="next.html" class="btn btn-neutral float-left" title="next command" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2003-2020 Sandia Corporation

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>

  
  
    
   

</body>
</html>