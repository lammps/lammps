# Uses a combnation of fix active and fix langevin to achieve
# self-propelled particles.

dimension 3
boundary p p p
units lj

# Fix active uses quaternions to orient the active force so you need 
# ellipsoidal particles, even if you do not care about asymmetric shape
atom_style ellipsoid


# Set up box and particles:
variable L equal 10
region total block -$L $L -$L $L -$L $L
create_box 1 total
variable N equal 1000
create_atoms 1 random $N 123456 total

# Set particle shape:
set group all shape 1 1 1
set group all quat/random 18238
variable V   equal "4.0*PI"
variable rho equal "1.0 / v_V"
# Density so that mass = 1
set group all density ${rho}

# Simple repulsive LJ
pair_style lj/cut 1.1225
pair_coeff * * 0.0 1.0
pair_modify shift yes

# Remove initial overlap:
minimize 1e-4 1e-6 1000 10000
reset_timestep 0

# Fixes for time integration
fix step all nve/asphere

# Should lead to constant velocity of 10 per particle
fix active all active 1.0
fix visc all viscous 0.1

# Initial velocities:
velocity all create 1.0 1234

variable DUMP_OUT string "active_viscous.dump"
variable MSD_OUT string "active_viscous_msd.dat"

# Compute temperature and orientation
compute T    all temp/asphere
compute quat all property/atom quatw quati quatj quatk
compute msd  all msd
compute vacf all vacf

# Some output:
thermo_style custom time step pe ke etotal temp c_T
thermo 1000

dump traj all custom 100 ${DUMP_OUT} id type x y z &
	c_quat[1] c_quat[2] c_quat[3] c_quat[4] 

fix msd all ave/time 1 10 50 c_msd[4] c_vacf[1] c_vacf[2] c_vacf[3] c_vacf[4] file ${MSD_OUT}

timestep 0.001
run 10000
